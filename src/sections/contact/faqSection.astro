---
// Components
import FaqElement from "../../components/contact/faqElement.astro";
import SectionTitle from "../../components/global/sectionTitle.astro";
// Data
const { sectionContent, sectionId } = Astro.props;
---

<section id={sectionId}>
  <div class="wrapper">
    <SectionTitle
      sectionTitle={sectionContent.title}
      subTitle={sectionContent.subtitle}
      headerStyle="text-center"
    />

    <div class="faq-wrapper">
      <ul class="faqs" role="list">
        {
          sectionContent.list.map((faq: any, i: number) => {
            return (
              <FaqElement
                componentContent={faq}
                index={i}
              />
            );
          })
        }
      </ul>
    </div>
  </div>
</section>

<style>
  .faq-wrapper {
    margin-inline: auto;
    width: 80%;
  }
</style>

<script is:inline>
  const faqWrapper = document.querySelector(".faq-wrapper");
  const accordions = document.querySelectorAll(".accordion");

  // Functie om alle accordions te sluiten en ARIA-attributen te resetten
  const closeAllAccordions = () => {
    accordions.forEach((accordion) => {
      const trigger = accordion.querySelector(".accordion-trigger");
      const content = accordion.querySelector(".accordion-content");

      accordion.classList.remove("is__open");
      if (trigger) trigger.setAttribute("aria-expanded", "false");
      if (content) content.setAttribute("aria-hidden", "true");
    });
  };

  faqWrapper.addEventListener("click", (e) => {
    const trigger = e.target.closest(".accordion-trigger");

    // Stop als er niet op een trigger (knop) is geklikt
    if (!trigger) return;

    const accordion = trigger.closest(".accordion");
    const content = accordion.querySelector(".accordion-content");
    const isOpen = accordion.classList.contains("is__open");

    // Als de geklikte accordion al open was, sluit alles en stop.
    // Anders, sluit eerst alles en open daarna de juiste.
    if (isOpen) {
      closeAllAccordions();
    } else {
      closeAllAccordions();
      accordion.classList.add("is__open");
      trigger.setAttribute("aria-expanded", "true");
      if (content) content.setAttribute("aria-hidden", "false");
    }
  });

  // Event listener voor klikken buiten de FAQ-wrapper
  document.addEventListener("click", (e) => {
    if (!faqWrapper.contains(e.target)) {
      closeAllAccordions();
    }
  });

  // Event listener voor de Escape-toets
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeAllAccordions();
    }
  });
</script>
